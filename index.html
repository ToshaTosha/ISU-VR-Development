<!-- 
"Live Server" in VS Code 
          or 
"python -m http.server" 
-->

<html>
<head>
    <title>Find oasis</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-play-sound-on-event@1.0.2/dist/aframe-play-sound-on-event.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.2/dist/aframe-extras.min.js"></script>
  </head>
  <body>
    <a-scene physics="debug: false; gravity: -9.8">

      <a-assets>
        <!-- музыка -->
        <audio id="lake" src="assets/sounds/lake.mp3" preload="auto"></audio>
     
        <!-- текстуры -->
        <img id="clear-sky" src="assets/textures/sky.jpg">
        <img id="sand4" src="assets/textures/sand4_diff.jpg">
        <img id="sand4_nor" src="assets/textures/sand4_nor.jpg">
        <img id="brick" src="assets/textures/brick_diff.jpg">
        <img id="brick_nor" src="assets/textures/brick_nor.jpg">
        <img id="cloud" src="assets/textures/cloud2.jpg">
        <img id="water" src="assets/textures/water2.jpg">
        <img id="water_nor" src="assets/textures/water2nor.jpg">

        <!-- <a-assets-item id="cactus" src="assets/models/cactus1.glb"></a-assets-item> -->
        <a-assets-item id="cactus_big" src="assets/models/cactus_verde.glb"></a-assets-item>
        <a-assets-item id="palm" src="assets/models/coconut_palm.glb"></a-assets-item>
        <a-assets-item id="camel" src="assets/models/camel.glb"></a-assets-item>
        <a-assets-item id="plant" src="assets/models/devongreen_stylized_plant.glb"></a-assets-item>
        <a-assets-item id="rock" src="assets/models/low_poly_desert_rock.glb"></a-assets-item>
        <a-assets-item id="cham" src="assets/models/low_poly_orange_panther_chameleon.glb"></a-assets-item>
        <a-assets-item id="ruin" src="assets/models/jetty_ruins_polycam_ipad_pro_lidar.glb"></a-assets-item>
        <a-assets-item id="stone" src="assets/models/low_poly_rock.glb"></a-assets-item>
        <a-assets-item id="stone-gray" src="assets/models/stone_low-poly.glb"></a-assets-item>
        <a-assets-item id="weed" src="assets/models/tumbleweed_jumping.glb"></a-assets-item>
      </a-assets>

      <a-plane id="loading-screen" color="#933" position="0 0.1 21" width="3" height="1" rotation="-90 0 0" scale="0.9 0.9 0.9">
        <a-text value="Is there any water?..." color="#000" align="center" position="0 0 0"></a-text>
      </a-plane>
      
      <a-camera position="0 1.4 23">
        <a-cursor></a-cursor>
      </a-camera>

      <!-- примеры всех моделей -->

      <!-- <a-entity id="cactus" visible="true" gltf-model=#cactus position="0 5 5"></a-entity> тяжеловатая моделька использовать мало -->

      <!-- <a-entity id="palm" visible="true" gltf-model=#palm position="0 5 0"></a-entity>
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="0 5 10"></a-entity>
      <a-entity visible="true" gltf-model="#camel" animation-mixer position="0 5 15"></a-entity>
      <a-entity visible="true" gltf-model="#plant" position="0 5 20"></a-entity>
      <a-entity visible="true" gltf-model="#rock" position="0 5 25"></a-entity>
      <a-entity visible="true" gltf-model="#cham" position="0 5 -5" scale="0.02 0.02 0.02"></a-entity>
      <a-entity visible="true" gltf-model="#ruin" position="0 5 -15"></a-entity> -->

      <!-- элементы в начале появления -->
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="2 0.8 21" scale="0.8 0.8 0.8"></a-entity>
      <a-entity gltf-model="#rock" animation-mixer position="11 1 20" scale="2 2 2" rotation="0 90 90"></a-entity>
      <a-entity visible="true" gltf-model="#stone" position="-4.5 -1 28" scale="2 2 2" rotation="0 0 0"></a-entity>
      

      <!-- элементы лабиринта далее до пирамиды-->
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="4 2.5 15" scale="2.5 2.5 2.5" rotation="0 0 0"></a-entity>
      <a-entity gltf-model="#rock"  position="11 1 20" scale="2 2 2" rotation="0 90 90"></a-entity>
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="-11 1 16" scale="1.6 1.6 1.6"></a-entity>
      <a-entity visible="true" gltf-model="#ruin" position="0 1.7 17" scale="2 2 2" rotation="0 -30 0"></a-entity>
      <a-entity visible="true" gltf-model="#stone" position="5 -1 22"  scale="4 3 4" rotation="0 0 90"></a-entity>
      <a-entity visible="true" gltf-model="#ruin" position="8 1 7" scale="1.5 1.5 1.5" rotation="0 50 0"></a-entity>


      <!-- пирамида -->
      <a-cone rotation="0 -40 0" 
        side="double" 
        position="-14 5.01 4" 
        roughness="0.8"
        material="src: #brick; repeat: 15 5; normal-map: #brick_nor; normal-texture-repeat: 15 5; " 
        scale="10 10 10" segmentsheight="1" 
        segmentsradial="4"  
        geometry="radiusTop: 0; segmentsHeight: 1; segmentsRadial: 4">
      </a-cone>


      <!-- кактусы справа за камнями -->
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="12 0.6 14" rotation="0 30 0"></a-entity>
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="14 1 12.5" scale="1.6 1.6 1.6"></a-entity>
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="14 2 14" scale="2 2 2" rotation="10 0 0"></a-entity>


      <!-- руины перед оазисом-->
      <a-entity visible="true" gltf-model="#stone" position="7 -1 -11" scale="2 1.5 5" rotation="0 105 0"></a-entity>
      <a-entity gltf-model="#rock" animation-mixer position="5 0.5 -7" scale="2 2 2" rotation="0 60 90"></a-entity>
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="-7 2 -4.5" scale="2.5 2.5 2.5" rotation="0 0 0"></a-entity>
      <a-entity visible="true" gltf-model="#stone" position="-2.5 -0.5 -11" scale="2 2 2" rotation="0 180 0"></a-entity>
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="2 1.6 -7" scale="1.6 1.6 1.6" rotation="0 0 0"></a-entity>
      
      <a-entity gltf-model="#rock" animation-mixer position="20 0 -17" scale="2 4 3" rotation="0 100 90"></a-entity>
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="8 1.5 -20" scale="1.6 1.6 1.6" rotation="0 0 0"></a-entity>
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="7 1 -21" scale="1 1 1" rotation="0 75 0"></a-entity>
    
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="21.5 1 -4.5" rotation="0 20 0"></a-entity>
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="21 1.6 -6" scale="1.6 1.6 1.6"></a-entity>
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="23 2 -4" scale="2 2 2" rotation="0 0 -8"></a-entity>
      <a-entity id="cactus_big" visible="true" gltf-model=#cactus_big position="22 3 -2" scale="3 3 3" rotation="0 0 0"></a-entity>


      

      <!-- хамелеоны -->
      <a-entity visible="true" gltf-model="#cham" position="8 0.2 19" scale="0.02 0.02 0.02" rotation="0 -90 0" 
      event-set__click="_event: click; visible:false"></a-entity>
      <!-- который рядом с оазисом -->
      <a-entity visible="true" gltf-model="#cham" position="2 0.2 -12" scale="0.02 0.02 0.02" rotation="0 -90 0" 
      event-set__enter="_event: mouseenter; visible:false"
      event-set__leave="_event: mouseleave; visible:true"></a-entity>
     
      <!-- перекати поле -->
      <a-entity gltf-model=#weed position="-4 0 6" dynamic-body
        animation="property: position; to: 20 0 -6; dur: 20000; dir: alternate; loop: true"
        animation__rotation="property: rotation; to: 0 360 0; dur: 5000; dir: alternate; loop: true">
      </a-entity>
     

      <!-- мираж -->
      <a-entity id="mySound" sound="src: #lake; loop: true; volume: 0.7;"></a-entity>
      <a-box 
        id="oasis-trigger"
        position="-9 0 -15" 
        visible="false"
        width="13" 
        height="13" 
        depth="13" >
      </a-box>

      <script>
        let soundEntity = document.querySelector('#mySound');
        let isPlaying = false;
        
        function soundControler() {
          if (isPlaying) {
            soundEntity.components.sound.stopSound();
            isPlaying = false;
          } else {
            soundEntity.components.sound.playSound();
            isPlaying = true;
          }
        }
      </script>

    
      <!-- земля -->
      <a-plane material="src: #sand4; repeat: 10 10; normal-map: #sand4_nor; normal-texture-repeat: 10 10" roughness="1" position="0 0 -5.2" rotation="-90 0 0" scale="75 75 1" ></a-plane>
      
      

      <a-entity id="oasisss" >
        <!-- оазис -->
      <a-entity gltf-model="#plant" visible="true"  position="-17 0.001 -15"  scale="" rotation=""></a-entity>
      <a-entity gltf-model="#plant" visible="true"  position="-16 0.001 -12"  scale="" rotation=""></a-entity>
      <a-entity gltf-model="#plant" visible="true"  position="-15 0.001 -10"  scale="1.5 1.5 1.5" rotation=""></a-entity>
      <a-entity gltf-model="#plant" visible="true"  position="-17 0.001 -11"  scale="" rotation=""></a-entity>

      <a-entity  gltf-model="#plant" visible="true"  position="-9.5 0.001 -20.5"  scale="" rotation=""></a-entity>
      <a-entity  gltf-model="#plant" visible="true"  position="-13 0.001 -17"  scale="1.5 1.5 1.5" rotation=""></a-entity>
      
      <a-entity  gltf-model="#plant" visible="true"  position="-15 0.001 -15"  scale="" rotation=""></a-entity>
      <a-entity  gltf-model="#plant" visible="true"  position="-14 0.001 -12"  scale="" rotation=""></a-entity>
      <a-entity  gltf-model="#plant" visible="true"  position="-13 0.001 -10"  scale="1.5 1.5 1.5" rotation=""></a-entity>
      <a-entity  gltf-model="#plant" visible="true"  position="-15 0.001 -11"  scale="" rotation=""></a-entity>
      
      <a-entity  gltf-model="#plant" visible="true"  position="-4 0.001 -14"  scale="" rotation=""></a-entity>
      <a-entity  gltf-model="#plant" visible="true"  position="-5 0.001 -12"  scale="" rotation=""></a-entity>
      <a-entity  gltf-model="#plant" visible="true"  position="-10.5 0.001 -9.5"  scale="1.5 1.5 1.5" rotation=""></a-entity>
      
      <a-entity  gltf-model="#plant" visible="true"  position="-7 0.001 -10"  scale="" rotation=""></a-entity>
      <a-entity  gltf-model="#plant" visible="true"  position="-9 0.001 -10"  scale="" rotation=""></a-entity>
      <a-entity  gltf-model="#plant" visible="true"  position="-12 0.001 -18"  scale="1.5 1.5 1.5" rotation=""></a-entity>
      <a-entity  gltf-model="#plant" visible="true"  position="-19 0.001 -14"  scale="" rotation=""></a-entity>
      
      <a-entity  gltf-model="#palm" visible="true"  position="-18 0 -8"  scale="" rotation=" 0 100 0"></a-entity>
      <a-entity  gltf-model="#palm" visible="true"  position="-17 0 -14"  scale="" rotation=" 0 80 0"></a-entity>

        <!-- верблюд -->
        <a-entity  visible="true" gltf-model="#camel" position="-15 0 -8" animation-mixer="clip: Armature|Idle_01"></a-entity>

        <!-- вода оазиса -->
      <a-circle 
      position="-9 0.001 -15" 
      rotation="-90 0 45"
      scale = "6 4 4"
      onclick="soundControler()"
      material="src: #water; repeat: 6 2; normal-map: #water_nor; normal-texture-repeat: 6 2; opacity: 0.6; transparent: true"
      animation__scale="property: scale; to: 6.1 4.1 4.1; dur: 2000; dir: alternate; easing: easeInOutSine; loop: true"
      animation__opacity="property: material.opacity; to: 0.8; dur: 2000; dir: alternate; easing: easeInOutSine; loop: true">
    </a-circle>
      </a-entity>

      <!-- Скрипт для управления появлением -->
      <script>
        AFRAME.registerComponent('show-on-look', {
          schema: {
            target: { type: 'selector' } // объект, который будет отображаться
          },
          init: function () {
            const el = this.el; // триггер
            const target = this.data.target; // пирамида
    
            el.addEventListener('mouseenter', () => {
              target.setAttribute('visible', 'true'); // показать пирамиду
            });
    
            el.addEventListener('mouseleave', () => {
              target.setAttribute('visible', 'false'); // скрыть пирамиду
            });
          }
        });
    
        // Применение компонента
        document.querySelector('#oasis-trigger').setAttribute('show-on-look', 'target: #oasisss');
      </script>

      <!-- небо -->
      <a-sky src="#clear-sky" radius="25" rotation="20 50 300" side="double"></a-sky> 

      <!-- облака -->
      <a-icosahedron position="10 18 1" scale="3 1 1"  material="src: #cloud; transparent: true; opacity: 0.5" animation="property: position; to: -20 20 1; dur: 18000; easing: linear; loop: true"></a-icosahedron>
      <a-icosahedron position="17 19 10" scale="5 1 1" material="src: #cloud; transparent: true; opacity: 0.5" animation="property: position; to: -20 21 10; dur: 25000; easing: linear; loop: true"></a-icosahedron>></a-icosahedron>
      <a-icosahedron position="15 20 5" scale="4 1 1" material="src: #cloud; transparent: true; opacity: 0.5" animation="property: position; to: -30 22 5; dur: 30000; easing: linear; loop: true"></a-icosahedron>></a-icosahedron>
      <a-icosahedron position="20 21 -6" scale="4 1 1" material="src: #cloud; transparent: true; opacity: 0.5" animation="property: position; to: -30 23 -6; dur: 35000; easing: linear; loop: true"></a-icosahedron>></a-icosahedron>
      <a-icosahedron position="40 19 8" scale="6 1 1" material="src: #cloud; transparent: true; opacity: 0.5" animation="property: position; to: -30 23 -6; dur: 40000; easing: linear; loop: true"></a-icosahedron>></a-icosahedron>
      <!-- свет -->
      <a-light type="ambient" color="#e2ca76"></a-light>
      <a-light type="point" intensity="1" position="-13.6 15 3"></a-light>
      
      

    </a-scene>
    
  </body>
</html>